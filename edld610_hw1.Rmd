---
title: "Homework 1"
author: "Cameron Kay, Lea Frank, and Ashley L. Miller"
date: "1/23/2019"
output:
  html_document:
    highlight: zenburn
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      fig.width = 7.5,
                      fig.height = 4.0)

#load packages
library(rio)
library(here)
library(tidyverse)
library(magrittr)

#Disable scientific notation
options(scipen = 999)

```

### Load the data

```{r load_data}

#load data (7 files total)

data_assess <- import(here::here("data", "assessments.csv"),
                      setclass = "tbl_df") %>%
  janitor::clean_names()

data_courses <- import(here::here("data", "courses.csv"),
                       setclass = "tbl_df") %>% 
  janitor::clean_names()

data_std_assess <- import(here::here("data", "studentAssessment.csv"),
                          setclass = "tbl_df") %>% 
  janitor::clean_names()

data_std_info <- import(here::here("data", "studentInfo.csv"),
               setclass = "tbl_df") %>% 
  janitor::clean_names()

data_std_regist <- import(here::here("data", "studentRegistration.csv"),
               setclass = "tbl_df") %>% 
  janitor::clean_names()

data_std_vle <- import(here::here("data", "studentVle.csv"),
               setclass = "tbl_df") %>% 
  janitor::clean_names()

#For some reason, in the data_vle file, the columns for week_from and week_to consist of all NAs????
data_vle <- import(here::here("data", "vle.csv"),
               setclass = "tbl_df") %>% 
  characterize() %>%
  janitor::clean_names()

```

### This primary components of this assignment are highly open-ended. These are to:

  + **Use at least 3 mutating joins**
  
  + **Produce at least 3 data displays**

```{r identify_keys}

#Identify key in course data:
#Key = code_module + code_presentation

data_courses %>% 
  count(code_module, code_presentation) %>% 
  filter(n > 1)

#Identify key in assessment data:
#Key = id_assessment

data_assess %>% 
  count(id_assessment) %>% 
  filter(n > 1)

#Identify key in VLE data:
#Key = id_site

data_vle %>% 
  count(id_site) %>% 
  filter(n > 1)

#Identify key in student info data:
#Key = code_module + code_presentation + id_student

data_std_info %>% 
  count(code_module, code_presentation,id_student) %>% 
  filter(n > 1)

#Identify key in student registration file
#Key = code_module + code_presentation + id_student

data_std_regist %>% 
  count(code_module, code_presentation, id_student) %>% 
  filter(n > 1)

#Identify key in student assessment data:
#Key = id_student + id_assessment

data_std_assess %>% 
  count(id_student, id_assessment) %>% 
  filter(n > 1)

####################################
#Identify key in student VLE file:
#NO KEY
####################################

data_std_vle %>% 
  count(code_module, code_presentation, id_student, id_site, date, sum_click) %>% 
  filter(n > 1)

#Create surrogate key?
data_std_vle %<>% 
  rowid_to_column()

data_std_vle %>%
  count(rowid) %>%
  filter(n > 1)

```

#### Mutating join/data visualization #1 (Ashley's)

```{r ash_mutating_join}

ash_data <- left_join(data_std_assess, data_std_info) #joined by id_student

ash_data %>% 
  count(id_assessment, id_student, code_module, code_presentation) %>% #key
  filter(n > 1)

ash_data <- ash_data %>%
  group_by(id_student) %>%
  summarize(mean_score = mean(score)) %>%
  left_join(ash_data)

ash_data%<>%
  select(id_student, mean_score, gender:age_band, disability) %>%
  distinct(id_student, .keep_all = TRUE)

```

```{r ash_data_visualization}

ggplot(ash_data, aes(x = age_band, y = mean_score, fill = age_band)) +
  geom_violin() +
  ggforce::geom_sina(size = 0.5) +
  geom_boxplot(alpha = 0) +
  scale_fill_manual(values = c("#157381", "#4D306E", "#C0A5E1")) +
  facet_wrap(~gender) +
  theme_bw() +
  labs(title = "Figure 1.",
       subtitle = "Assessment score distributions by age group and gender",
       x = "Age Group", 
       y = "Mean Assessment Score") +
  theme(legend.position = "none")

ggplot(ash_data, aes(x = highest_education, y = mean_score, fill = highest_education)) +
  geom_violin() +
  ggforce::geom_sina(size = 0.5) +
  geom_boxplot(alpha = 0) +
  scale_fill_viridis_d() +
  theme_bw() +
  labs(title = "Figure 2.",
       subtitle = "Assessment score distributions by level of education",
       x = "Education Level", 
       y = "Mean Assessment Score") +
  theme(legend.position = "none")

```

#### Join/Data visualization #2

```{r mutatejoin2}



```

#### Join/Data visualization #3

```{r mutatejoin3}



```

#### Filter join

```{r filtering join}



```
  
### Reproduce the following figure:

```{r reproduce_figure}



```