---
title: "Homework 1"
author: "Cameron Kay, Lea Frank, and Ashley L. Miller"
date: "1/23/2019"
output:
  html_document:
    highlight: zenburn
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      fig.width = 7.5,
                      fig.height = 4.0)

# load packages
library(rio)
library(here)
library(tidyverse)
library(magrittr)

# disable scientific notation
options(scipen = 999)

```

```{r load_data}

# load data (7 files total)

data_assess <- import(here::here("data", "assessments.csv"),
                      setclass = "tibble") %>%
  janitor::clean_names()

data_courses <- import(here::here("data", "courses.csv"),
                       setclass = "tibble") %>% 
  janitor::clean_names()

data_std_assess <- import(here::here("data", "studentAssessment.csv"),
                          setclass = "tibble") %>% 
  janitor::clean_names()

data_std_info <- import(here::here("data", "studentInfo.csv"),
               setclass = "tibble") %>% 
  janitor::clean_names()

data_std_regist <- import(here::here("data", "studentRegistration.csv"),
               setclass = "tibble") %>% 
  janitor::clean_names()

data_std_vle <- import(here::here("data", "studentVle.csv"),
               setclass = "tibble") %>% 
  janitor::clean_names()

# for some reason, in the data_vle file, the columns for week_from and week_to consist of all NAs????
data_vle <- import(here::here("data", "vle.csv"),
               setclass = "tibble") %>% 
  characterize() %>%
  janitor::clean_names()

```

```{r identify_keys, include=FALSE}

# identify key in course data:
# key = code_module + code_presentation

data_courses %>% 
  count(code_module, code_presentation) %>% 
  filter(n > 1)

# identify key in assessment data:
# key = id_assessment

data_assess %>% 
  count(id_assessment) %>% 
  filter(n > 1)

# identify key in VLE data:
# key = id_site

data_vle %>% 
  count(id_site) %>% 
  filter(n > 1)

# identify key in student info data:
# key = code_module + code_presentation + id_student

data_std_info %>% 
  count(code_module, code_presentation,id_student) %>% 
  filter(n > 1)

# identify key in student registration file
# key = code_module + code_presentation + id_student

data_std_regist %>% 
  count(code_module, code_presentation, id_student) %>% 
  filter(n > 1)

# identify key in student assessment data:
# key = id_student + id_assessment

data_std_assess %>% 
  count(id_student, id_assessment) %>% 
  filter(n > 1)

####################################
# Identify key in student VLE file:
# NO KEY
####################################

data_std_vle %>% 
  count(code_module, code_presentation, id_student, id_site, date, sum_click) %>% 
  filter(n > 1)

# create surrogate key?
data_std_vle %<>% 
  rowid_to_column()

data_std_vle %>%
  count(rowid) %>%
  filter(n > 1)

```

#### 1) Mutating join/data visualization #1 (Ashley's)

  + **Mutating join**

```{r ash_mutating_join}

ash_data <- left_join(data_std_assess, data_std_info) #joined by id_student

# identify key
# ash_data %>% 
  # count(id_assessment, id_student, code_module, code_presentation) %>% key
  # filter(n > 1)

ash_data <- ash_data %>%
  group_by(id_student) %>%
  summarize(mean_score = mean(score)) %>%
  left_join(ash_data)

ash_data%<>%
  select(id_student, mean_score, gender:age_band, disability) %>%
  distinct(id_student, .keep_all = TRUE)

```

  + **Resulting data visualization(s)**

```{r ash_data_visualization}

ggplot(ash_data, aes(x = age_band, y = mean_score, fill = age_band)) +
  geom_violin() +
  ggforce::geom_sina(size = 0.5) +
  geom_boxplot(alpha = 0) +
  scale_fill_manual(values = c("#157381", "#4D306E", "#C0A5E1")) +
  facet_wrap(~gender) +
  theme_bw() +
  labs(title = "Figure 1.",
       subtitle = "Assessment score distributions by age group and gender",
       x = "Age Group", 
       y = "Mean Assessment Score") +
  theme(legend.position = "none")

ggplot(ash_data, aes(x = highest_education, y = mean_score, fill = highest_education)) +
  geom_violin() +
  ggforce::geom_sina(size = 0.5) +
  geom_boxplot(alpha = 0) +
  scale_fill_viridis_d() +
  theme_bw() +
  labs(title = "Figure 2.",
       subtitle = "Assessment score distributions by level of education",
       x = "Education Level", 
       y = "Mean Assessment Score") +
  theme(legend.position = "none")

```

#### 2) Mutating join/data visualization #2

```{r mutatejoin2}



```

#### 3) Mutating join/data visualization #3

```{r mutatejoin3}



```

#### 4) Filter join

```{r filtering join}



```
  
#### 5) Reproduce the following figure:

```{r reproduce_figure}



```